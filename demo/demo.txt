## create
export PATH=$PWD/../nuv:$PATH
export PAGER=cat
export $(xargs <../../nuvolaris-operator/nuvolaris-test/.env)
nuv -v

clear ; rich 'Welcome - this is a demo of [b]Nuvolaris[/b] a portable serverless for [i]Kubernetes[/i]' -p -c --padding 1 --style "on blue"
nuv -v

# other terminal
rich 'Installing [b]Nuvolaris[/b] locally' -p -a double
nuv setup --devcluster

clear ; rich 'Sample in [b]JavaScript[/b]' -p -c --padding 1 --style "on blue" ; 
rich hi.js
nuv wsk action update hi hi.js --web=true
nuv wsk action invoke hi -r
nuv wsk action invoke hi -p name Rob -r
nuv wsk action get  hi --url
curl http://localhost:3233/api/v1/web/guest/default/hi?name=Jane

# python
clear ; rich 'Sample in [b]Python[/b]' -p -c --padding 1 --style "on blue" ; 
rich hi.py
nuv wsk action update hipy hi.py --web=true
nuv wsk action invoke hipy -r
nuv wsk action invoke hipy -p name Rob -r
nuv wsk action get  hipy --url
curl http://localhost:3233/api/v1/web/guest/default/hipy?name=Jane


clear ; rich 'Sample in [b]Go[/b] with a prebuilt binary action' -p -c --padding 1 --style "on blue" ; 
nuv wsk action update chess chess.zip --kind=go:1.15 --web=true
nuv wsk action get chess --url


# AWS EKS
clear ; rich 'Using [b]Amazon EKS Kubernetes[/b]' -p -c --padding 1 --style "on blue" ; 
aws eks list-clusters --output=table
aws eks update-kubeconfig --name=nuvolaris-cluster
kubectl config current-context
rich 'Installing [b]Nuvolaris[/b] on AWS EKS' -p -a double
nuv setup --context=arn:aws:eks:eu-central-1:008226817162:cluster/nuvolaris-cluster
rich 'Testing Javascript and Python on EKS' -p -a double
nuv wsk action update hi hi.js --web=true
nuv wsk action invoke hi -p name Rob -r
nuv wsk action update hipy hi.py --web=true
curl "$(nuv wsk action get hipy --url | tail +2)?name=Jane"

# Linode LKS
clear ; rich 'Using [b]Linode LKS Kubernetes[/b]' -p -c --padding 1 --style "on blue" ; 
linode-cli lke clusters-list
linode-cli lke kubeconfig-view 55272 --json | jq -r '.[].kubeconfig | @base64d'  >~/.kube/config
kubectl config current-context
rich 'Installing [b]Nuvolaris[/b] on Linode LKS' -p -a double
nuv setup --context=lke55272-ctx
rich 'Testing Javascript and Python on LKS' -p -a double
nuv wsk action update hi hi.js --web=true
nuv wsk action invoke hi -p name Rob -r
nuv wsk action update hipy hi.py --web=true
curl "$(nuv wsk action get hipy --url | tail +2)?name=Jane"








